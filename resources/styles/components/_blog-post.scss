@use '../abstracts/' as *;

.blog-post {
    margin-block: $size-13;
    position: relative;

    @include mq(large) {
        margin-block-start: $size-13;
        display: grid;
        grid-template-columns: 1fr 2fr 0px;
        grid-template-areas:
            "info body media";
        align-items: stretch;

        &__header {
            grid-area: info;
            justify-content: end;
            height: 100%;
            position: static;
            overflow: visible;
        }

        &__body {
            grid-area: body;
        }

        &__media {
            grid-area: media;
        }
    }

    &__header {
        margin-block: $size-5;

        @include mq(large) {
            margin-block: 0;
        }

        .post-header-sticky-wrapper {
            @include mq(large) {
                position: sticky;
                top: calc(80px + 20px);
                z-index: 10;
                transform: translateX(0);
                transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.4, 1);
            }

            .post-header {
                position: relative;

                &__meta-group {

                    .post-title {
                        margin-block-end: $size-6;
                        font-size: $font-size-800;
                        font-family: $font-family-medium;
                    }

                    .meta-primary {
                        display: flex;
                        flex-direction: column;
                        gap: $size-4;
                        font-size: $font-size-400;

                        @include mq(large) {
                            margin-block-end: $size-6;

                            .author, .category {
                                &:hover {
                                    color: $color-secondary-200;
                                }
                            }
                        }

                        .author, .category, .date {
                            text-decoration: none;
                            color: $color-primary-300;
                        }
                    }
                }

                .toggle-media-button {
                    display: none;

                    @include mq(large) {
                        position: absolute;
                        right: -21px;
                        top: 3px;
                        display: block;
                        width: fit-content;
                        pointer-events: all;
                        cursor: pointer;
                    }
                }
            }

            .post-interactions-wrapper {
                display: none;

                @include mq(large) {
                    display: flex;
                    align-items: center;
                    padding-inline-start: $size-4;
                    gap: $size-4;

                    .share-wrapper {
                        @include mq(large) {
                            display: flex;
                            align-items: center;

                            .share-icon {
                                padding: $size-4;

                                &:hover {
                                    background: $color-primary-900;
                                }
                            }
                            
                            .share-menu--desktop {
                                @include share-menu-base;
                                @include share-menu-desktop;
                            }
                        }
                    }
                }
            }
        }
    }

    &__body {
        font-size: $font-size-500;
        line-height: 33px;
        color: $color-primary-200;
        
        img {
            width: fit-content;
            margin: auto;
            height: auto;
            margin-block: $size-8;
        }

        iframe {
            border: none;
            margin-block: $size-8;
        }

        &__subheader {
            .extract {
                padding-block-end: $size-4;
            }

            .preview-img-wrapper {
                margin-block: $size-5;
                width: 100%;
                max-width: 100%;
                height: 240px;
                overflow: hidden;

                .preview-img {
                    width: 100%;
                    height: 100%;
                    object-position: top;
                    object-fit: cover;
                    margin-block: 0;
                }

                @include mq(medium) {
                    cursor: zoom-in;
                    height: 500px;
                }

                @include mq(large) {
                    width: 100%;
                    margin-block: 0;
                }
            }
        }
    }

    .media-sticky {
        // Estilos por defecto para mobile
        display: block;
        position: relative;

        // Estilos para desktop (sticky + scrolltrigger)
        @include mq(large) {
            position: sticky;
            top: 100px;
            height: calc(100vh - 100px);
        
            .blog-post__media {
                .media-container {
                    position: sticky;
                    top: 0;
                    height: calc(100vh - 100px);
                    overflow: hidden;

                    .media-item {
                        position: absolute;
                        top: 0;
                        left: 0;
                        opacity: 0;
                        transition: opacity 0.6s ease;
                        width: 100%;
                        height: 100%;
                        display: flex;
                        align-items: flex-start;
                        justify-content: center;
                        padding: $size-10;

                        iframe {
                            width: 100%;
                            aspect-ratio: 16 / 9;
                            border: none;
                        }

                        &.visible {
                            opacity: 1;
                            z-index: 1;
                        }
                    }
                }
            }
        }
    }

    &__comments {
        margin-block: $size-4;
        display: flex;
        flex-direction: column;

        &__form {
            margin-block: $size-8;
            display: flex;
            flex-direction: column;
        }

        &__thread {
            padding-inline: $size-3;

            @include mq(large) {
                margin-block-start: $size-8;
            }

            .comment-container {
                display: flex;
                flex-direction: column;
                margin-block-end: $size-8;
                position: relative;

                .comment-wrapper {
                    position: relative;

                    // la linea horizontal
                    &::after {
                        content: '';
                        position: absolute;
                        left: -42px;
                        top: 24px;
                        width: 30px;
                        height: 1px;
                        background: $color-primary-500;
                    }

                    // le quita la linea horizontal al comentario original
                    &.is-root::after {
                        display: none;
                        content: none;
                    }

                    .comment-content {
                        // la linea vertical
                        &::before {
                            content: '';
                            position: absolute;
                            left: -12px;
                            top: 0;
                            bottom: 0;
                            width: 1px;
                            background: $color-primary-500;
                        }

                        &:last-child::before {
                            height: 24px;
                        }

                        &__header {
                            display: flex;
                            gap: $size-2;
                            align-items: center;

                            .delete-icon-wrapper {
                                border: none;
                                margin-left: auto;
                                margin-right: $size-4;
                                background: transparent;

                                button {
                                    path {
                                        stroke: #F83B3B;
                                    }
                                }
                            }

                            &__author {
                                display: flex;
                                gap: $size-2;
                                align-items: center;
                                font-size: $font-size-400;
                                color: $color-accent-300;
                            }

                            &__date {
                                color: $color-primary-200;
                                font-size: $font-size-300;
                            }
                        }

                        &__body {
                            font-size: $font-size-400;
                            padding-block: $size-2;
                            color: $color-primary-200;
                        }

                        &__actions {
                            display: flex;
                            align-items: center;
                            gap: $size-2;

                            .reply-icon {
                                display: flex;
                                align-items: center;
                                gap: $size-1;
                                padding: 0 $size-2;
                                border-radius: $size-1;
                                transition: 0;

                                &::after {
                                    content: 'reply';
                                    font-size: 12px;
                                    text-transform: uppercase;
                                }

                                &:hover {
                                    background: $color-primary-900;
                                }
                            }

                            .delete-icon-wrapper {
                                display: flex;
                                align-items: center;
                                gap: $size-1;
                                padding: 0 $size-2;
                                border-radius: $size-1;
                                transition: 0;
                                font-size: 12px;
                                text-transform: uppercase;
                                cursor: pointer;

                                &:hover {
                                    background: $color-primary-900;
                                }
                            }
                        }
                    }

                    .comment-replies {
                        position: relative;

                        .reply-form {
                            margin-block: $size-2;
                            display: flex;
                            flex-direction: column;

                            button {
                                width: fit-content;
                                border-radius: .5rem;
                            }
                        }

                        .replies {
                            margin-block-start: $size-6;
                        }

                        .suggestions-wrapper {
                            position: relative;

                            .suggestions {
                                position: absolute;
                                bottom: 100%;
                                left: 0;
                                right: 0;
                                background: $color-primary-700;
                                border-radius: 4px;
                                max-height: 150px;
                                overflow-y: auto;
                                z-index: 100;

                                &__item {
                                    cursor: pointer;
                                    padding: $size-1 $size-2;
                                    font-size: $font-size-400;
                                    transition: all 0.2s ease;

                                    &:hover {
                                      background-color: $color-primary-600;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

.mobile-interactions-wrapper {
    position: fixed;
    bottom: 70px;
    left: 0;
    right: 0;
    height: 70px;
    background: $color-primary-900;
    border-top: 1px solid $color-primary-500;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    z-index: 100;
    display: flex;
    justify-content: center;
    align-items: center;

    .like-button-wrapper {
        border: 1px transparent;
        background: transparent;

        .like-button--mobile {
            height: 50px;
            color: $color-neutral-100;
            font-size: 14px;
        }
    }

    .share-wrapper {
        position: relative;
        
        .share-icon {
            padding: $size-2;
            display: flex;
            align-items: center;
            flex-direction: column-reverse;
            text-transform: uppercase;
            font-size: 14px;
            gap: .2rem;

            &:after {
                content: 'share';
                color: $color-neutral-100;
            }
        }

        .share-menu--mobile {
            @include share-menu-base;
            @include share-menu-mobile;
        }
    }

    &.is-visible {
        transform: translateY(0);
    }

    @include mq(large) {
        display: none;
    }
}

// TRANSICIONES
// "Expanded" y "Collapsed", se refieren a "Media"
// Expanded Media -> Collapsed Header
// Collapsed Media -> Expanded Header
.blog-post {
    transition: grid-template-columns 0.2s cubic-bezier(0.5, 0.8, 0.6, 1);
    
    @include mq(large) {
        // header
        &[data-state="expanded"] {
            grid-template-columns: 20px 2fr 1.5fr;
            // contenedor principal que se traslada horizontalmente
            .post-header-sticky-wrapper {
                transition: transform 0.4s cubic-bezier(0.5, 0.8, 0.6, 1);
                
                .post-interactions-wrapper {
                    opacity: 0;
                    pointer-events: none;
                    // transition: opacity 0.3s cubic-bezier(0.5, 0.8, 0.6, 1);
                }

                .post-header {
                    &__meta-group {
                        opacity: 0;
                        pointer-events: none;
                        transition: opacity 0.2s cubic-bezier(0.5, 0.8, 0.6, 1) 0.1s;

                        .post-title {
                            opacity: 0;
                            font-size: $font-size-400;
                            height: fit-content;
                            width: fit-content;
                        }
                        .meta-primary {
                            opacity: 0;
                        }
                    }

                    .toggle-media-button {
                        left: -17px;
                    }
                }
            }
        }
    }
}