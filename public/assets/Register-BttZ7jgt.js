import{c as _,o as f,e as s,j as B,i as w,k as j,l as T,C as M,p as F,d as W,b as x,w as c,a as r,u as e,m as z,g as v,h as J,q as S,f as b,T as I,t as N,s as K,n as Y,v as U}from"./app-CRVfHUbl.js";import{_ as A}from"./createLucideIcon-DIyw9k4v.js";import{a as C,_ as E,I as L}from"./Label.vue_vue_type_script_setup_true_lang-BbkXiIER.js";import{_ as G}from"./TextLink.vue_vue_type_script_setup_true_lang-BBHQnpIi.js";import{L as $,_ as Q}from"./AuthLayout.vue_vue_type_script_setup_true_lang-BYfqmRAA.js";import"./index-DfbCg4Oz.js";import"./index-9o3e336w.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BpLbFC4_.js";const X={class:"list-container border-radius-1"},Z={class:"list-content"},ee={class:"list-footer"},ae={__name:"List",props:{type:{type:String,default:"default"}},setup(n){return(m,l)=>(f(),_("article",X,[s("div",Z,[B(m.$slots,"default")]),s("div",ee,[B(m.$slots,"footer")])]))}};function se(){const n=w(""),m=w(""),l=w(""),g=w(!1),i=w(!1),u=async()=>{g.value=!0,l.value="";try{const y=Date.now(),{data:o}=await T.get(`/captcha/generate?_=${y}`,{responseType:"blob",timeout:3e3});n.value&&URL.revokeObjectURL(n.value),n.value=URL.createObjectURL(o)}catch(y){l.value="Error loading challenge",console.error("CAPTCHA load failed:",y),setTimeout(()=>{u()},2e3)}finally{g.value=!1}},h=async()=>{var y,o,p;if(l.value="",i.value=!1,!((y=m.value)!=null&&y.trim()))return l.value="You must enter the band's name, unless you're a bot or a poser.",!1;try{const{data:t}=await T.post("/captcha/validate",{captcha_answer:m.value.trim()});return t.success?(i.value=!0,await new Promise(V=>setTimeout(V,1500)),!0):(l.value=t.error,await u(),!1)}catch(t){return l.value=T.isAxiosError(t)?((p=(o=t.response)==null?void 0:o.data)==null?void 0:p.error)||"Server error":"Verification failed",await u(),!1}},k=()=>{console.log("CAPTCHA image loaded successfully")};return j(()=>{u()}),{captchaImage:n,captchaAnswer:m,captchaError:l,isLoading:g,captchaSuccess:i,generateNewCaptcha:u,validateCaptcha:h,handleImageLoad:k}}function te(){const n=w(1),m=4,l=w(null),g=w(!1),i=w(""),u=M({username:"",email:"",password:"",password_confirmation:""}),h=async()=>{if(!u.username.trim()){l.value=null,i.value="";return}g.value=!0,i.value="";try{const{data:p}=await T.post("/check-username",{username:u.username.trim()});l.value=p.available,i.value=p.available?"":"Username is already taken."}catch(p){i.value="Error checking username availability",console.error("Username check failed:",p)}finally{g.value=!1}};let k;return F(()=>u.username,p=>{clearTimeout(k),k=setTimeout(()=>{h()},500)}),{currentStep:n,totalSteps:m,form:u,nextStep:()=>{if(n.value===2&&!u.username){i.value="Username is required";return}if(n.value===2&&l.value===!1){i.value="Username is already taken";return}if(n.value===3&&!u.email){i.value="Email is required";return}n.value<m&&n.value++},prevStep:()=>{n.value>1&&n.value--},usernameAvailable:l,checkingUsername:g,usernameError:i,checkUsernameAvailability:h}}const re={class:"even-columns container padding-inline-4 margin-block-start-10"},le={class:"fs-300 text-center padding-4 margin-block-2"},oe={class:"captcha-container"},ne={class:"captcha-container__image | text-center"},ie=["src"],ue={key:0,class:"spinner"},de={key:0,class:"success-message"},ce={class:"captcha-container__ui"},me={key:0,class:"captcha-error"},pe={class:"form-group flow"},fe={key:0,class:"clr-neutral-300 fs-300 flex-group"},ve={key:1,class:"clr-error-100 fs-300"},ge={class:"form-group flow"},ye={class:"form-group flow"},be={class:"form-group flow"},we={class:"flex-group mx-auto"},Ae=W({__name:"Register",setup(n){const{captchaImage:m,captchaAnswer:l,captchaError:g,isLoading:i,captchaSuccess:u,generateNewCaptcha:h,validateCaptcha:k,handleImageLoad:y}=se(),{currentStep:o,totalSteps:p,form:t,nextStep:V,prevStep:O,checkUsernameAvailability:D,checkingUsername:H,usernameError:P}=te(),R=async()=>{if(o.value===1){await k()&&o.value++;return}o.value===p?t.post(route("register")):V()};return(q,a)=>(f(),x(Q,{title:"Create an account",description:"Join a thriving community of opiniated metalheads"},{default:c(()=>[r(e(z),{title:"Register"}),s("section",re,[s("div",null,[r(ae,{class:"flow"},{default:c(()=>a[7]||(a[7]=[s("div",{class:"margin-block-end-6"},[s("h2",{class:"ff-accent clr-accent-300"},"Write rants that draw blood"),s("ul",null,[s("li",{style:{"list-style-type":"none"}},"Publish unfiltered reviews, rants and manifestos.")])],-1),s("div",{class:"margin-block-end-6"},[s("h2",{class:"ff-accent clr-accent-300"},"Forget algorithms, follow your gut"),s("ul",null,[s("li",{style:{"list-style-type":"none"}},"Keep up with the topics that interest you by following groups.")])],-1),s("div",{class:"margin-block-end-6"},[s("h2",{class:"ff-accent clr-accent-300"},'Smash the "Hail" button'),s("ul",null,[s("li",{style:{"list-style-type":"none"}},'Approve posts with a ðŸ¤˜ instead of a lame "like."')])],-1),s("h2",null,[v("...and "),s("span",{class:"italic"},"MORE!")],-1)])),_:1}),s("div",le,[a[9]||(a[9]=s("span",null,"Already have an account?",-1)),r(G,{class:"system-link | margin-inline-2",href:q.route("login"),tabindex:6},{default:c(()=>a[8]||(a[8]=[v(" Log in ")])),_:1},8,["href"])])]),s("form",{onSubmit:J(R,["prevent"]),class:"register-form | container"},[S(s("section",null,[s("div",oe,[s("div",ne,[a[11]||(a[11]=s("h3",null,"What band does this album belong to?",-1)),e(m)?(f(),_("img",{key:0,src:e(m),alt:"CAPTCHA Album Cover",class:"margin-block-4",onLoad:a[0]||(a[0]=(...d)=>e(y)&&e(y)(...d))},null,40,ie)):b("",!0),r(I,{name:"fade"},{default:c(()=>[e(i)?(f(),_("div",ue,[r(e($),{class:"spinner-circle"}),a[10]||(a[10]=s("p",null,"Poser Detector 5000 is working...",-1))])):b("",!0)]),_:1}),r(I,{name:"fade"},{default:c(()=>[e(u)&&e(o)===1?(f(),_("div",de," âœ“ Verified! Proceeding... ")):b("",!0)]),_:1})]),s("div",ce,[e(g)?(f(),_("div",me,N(e(g)),1)):b("",!0),r(e(C),{modelValue:e(l),"onUpdate:modelValue":a[1]||(a[1]=d=>K(l)?l.value=d:null),type:"text",placeholder:"Enter band name",class:"text-center",tabIndex:1},null,8,["modelValue"]),r(e(A),{type:"button",onClick:R,class:Y(["fw-base button mx-auto",{disabled:!e(l).valueOf()}]),"data-type":"accent",disabled:!e(l).valueOf()},{default:c(()=>a[12]||(a[12]=[v(" Verify ")])),_:1},8,["disabled","class"]),s("span",{onClick:a[2]||(a[2]=(...d)=>e(h)&&e(h)(...d)),class:"retry-captcha"}," â†» Try another album? ")])])],512),[[U,e(o)===1]]),S(s("section",null,[s("div",pe,[r(e(E),{for:"username"},{default:c(()=>a[13]||(a[13]=[v("User name")])),_:1}),e(H)?(f(),_("div",fe,[r(e($),{class:""}),a[14]||(a[14]=v(" Checking username... "))])):b("",!0),e(P)?(f(),_("div",ve,N(e(P)),1)):b("",!0),r(L,{message:e(t).errors.username},null,8,["message"]),r(e(C),{id:"username",type:"text",required:"",autofocus:"",tabindex:1,autocomplete:"username",modelValue:e(t).username,"onUpdate:modelValue":a[3]||(a[3]=d=>e(t).username=d),placeholder:"kill_the_kardashians_69",onBlur:e(D)},null,8,["modelValue","onBlur"])])],512),[[U,e(o)===2]]),S(s("section",null,[s("div",ge,[r(e(E),{for:"email"},{default:c(()=>a[15]||(a[15]=[v("Email address")])),_:1}),r(e(C),{id:"email",type:"email",required:"",tabindex:2,autocomplete:"email",modelValue:e(t).email,"onUpdate:modelValue":a[4]||(a[4]=d=>e(t).email=d),placeholder:"email@example.com"},null,8,["modelValue"]),r(L,{message:e(t).errors.email},null,8,["message"])])],512),[[U,e(o)===3]]),S(s("section",null,[s("div",ye,[r(e(E),{for:"password"},{default:c(()=>a[16]||(a[16]=[v("Password")])),_:1}),r(e(C),{id:"password",type:"password",required:"",tabindex:3,autocomplete:"new-password",modelValue:e(t).password,"onUpdate:modelValue":a[5]||(a[5]=d=>e(t).password=d),placeholder:"Password"},null,8,["modelValue"]),r(L,{message:e(t).errors.password},null,8,["message"])]),s("div",be,[r(e(E),{for:"password_confirmation"},{default:c(()=>a[17]||(a[17]=[v("Confirm password")])),_:1}),r(e(C),{id:"password_confirmation",type:"password",required:"",tabindex:4,autocomplete:"new-password",modelValue:e(t).password_confirmation,"onUpdate:modelValue":a[6]||(a[6]=d=>e(t).password_confirmation=d),placeholder:"Confirm password"},null,8,["modelValue"]),r(L,{message:e(t).errors.password_confirmation},null,8,["message"])])],512),[[U,e(o)===4]]),s("section",we,[e(o)>1&&e(o)!==2?(f(),x(e(A),{key:0,type:"button",onClick:e(O),class:"fw-base button mx-auto","data-type":"form-step-prev"},{default:c(()=>a[18]||(a[18]=[v(" Previous ")])),_:1},8,["onClick"])):b("",!0),e(o)<e(p)&&e(o)!==1?(f(),x(e(A),{key:1,type:"button",onClick:e(V),class:"fw-base button mx-auto","data-type":"form-step-next",disabled:e(o)===1&&!e(l).valueOf()},{default:c(()=>a[19]||(a[19]=[v(" Next ")])),_:1},8,["onClick","disabled"])):b("",!0),e(o)===e(p)?(f(),x(e(A),{key:2,type:"submit",class:"fw-base button mx-auto",disabled:e(t).processing,"data-type":"accent",tabindex:"5"},{default:c(()=>[e(t).processing?(f(),x(e($),{key:0,class:"spinning-loader"})):b("",!0),a[20]||(a[20]=v(" Create account "))]),_:1},8,["disabled"])):b("",!0)])],32)])]),_:1}))}});export{Ae as default};
